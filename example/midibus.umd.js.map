{"version":3,"file":"midibus.umd.js","sources":["../node_modules/mitt/dist/mitt.js","../src/message.js","../src/supported.js","../src/bus.js","../src/midibus.js"],"sourcesContent":["function n(n){return n=n||Object.create(null),{on:function(t,o){(n[t]||(n[t]=[])).push(o)},off:function(t,o){var u=n[t]||(n[t]=[]);u.splice(u.indexOf(o)>>>0,1)},emit:function(t,o){(n[t]||[]).map(function(n){n(o)}),(n[\"*\"]||[]).map(function(n){n(t,o)})}}}module.exports=n;\n//# sourceMappingURL=mitt.js.map","function message (channel, pitch, velocity) {\n  return {\n    channel,\n    pitch,\n    velocity\n  }\n}\n\nexport default message\n","const supported = !!navigator.requestMIDIAccess\n\nexport default supported\n","import mitt from 'mitt'\nimport message from './message'\nimport supported from './supported'\n\nconst PACKETS = {\n  noteOn: 0x80,\n  noteOff: 0x90\n}\n\nfunction bus (input, output) {\n  if (!supported) return null\n  if (!input && !output) {\n    throw new Error('A bus needs a least an input or an output device')\n  }\n\n  const emitter = mitt()\n  if (input) input.onmidimessage = onMessage\n\n  emitter.send = send\n  return emitter\n\n  function onMessage (e) {\n    const cmd = e.data[0] >> 4\n    const msg = message(e.data[0] & 0xf, e.data[1], e.data[2])\n\n    if (cmd === 8 || ((cmd === 9) && (msg.velocity === 0))) { // noteOff\n      emitter.emit('noteOff', msg)\n    } else if (cmd === 9) { // noteOn\n      emitter.emit('noteOn', msg)\n    } else if (cmd === 11) { // controller message\n      emitter.emit('controllerChange', msg)\n    } else { // sysex or other\n      emitter.emit('sysex', e)\n    }\n  }\n\n  function send (cmd, msg) {\n    if (!output) return\n    output.send([\n      PACKETS[cmd] ? PACKETS[cmd] + msg.channel : msg.channel,\n      msg.pitch,\n      msg.velocity\n    ])\n  }\n}\n\nexport default bus\n","import bus from './bus'\nimport message from './message'\nimport supported from './supported'\n\nlet _isReady = false\nlet inputs = []\nlet outputs = []\n\nfunction access (cb) {\n  if (!supported) return null\n  if (_isReady) return cb(null)\n  navigator.requestMIDIAccess().then(\n    (res) => {\n      res.inputs.forEach(el => inputs.push(el))\n      res.outputs.forEach(el => outputs.push(el))\n      _isReady = true\n      cb(null)\n    },\n    () => {\n      cb(new Error('No access to your midi devices.'))\n    })\n}\n\nexport { supported, inputs, outputs, access, bus, message }\n"],"names":["message","channel","pitch","velocity","supported","navigator","requestMIDIAccess","PACKETS","noteOn","noteOff","bus","input","output","Error","emitter","mitt","onmidimessage","onMessage","send","e","cmd","data","msg","emit","_isReady","inputs","outputs","access","cb","then","res","forEach","push","el"],"mappings":"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"}